<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Get started with adoptr ‚Ä¢ adoptr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get started with adoptr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">adoptr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/adoptr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/adoptr_jss.html">Overview Paper</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/working-with-priors.html">Working with Priors</a></li>
    <li><a class="dropdown-item" href="../articles/conditional-scores.html">Conditional Scores</a></li>
    <li><a class="dropdown-item" href="../articles/composite-scores.html">Composite Scores</a></li>
    <li><a class="dropdown-item" href="../articles/defining-new-scores.html">Definining New Scores</a></li>
    <li><a class="dropdown-item" href="../articles/other-endpoints.html">Non-normal Endpoints</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/optad/adoptr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Get started with adoptr</h1>
            
            <h4 data-toc-skip class="date">2024-10-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/optad/adoptr/blob/main/vignettes/adoptr.Rmd" class="external-link"><code>vignettes/adoptr.Rmd</code></a></small>
      <div class="d-none name"><code>adoptr.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="two-stage-designs-for-clinical-trials">Two-stage designs for clinical trials<a class="anchor" aria-label="anchor" href="#two-stage-designs-for-clinical-trials"></a>
</h3>
<p>In prospectively planned confirmatory clinical trials there has been
a long-standing debate about the merits of allowing pre-planned interim
analyses to stop or modify an ongoing trial, cf.¬† <a href="https://doi.org/10.1002/sim.6472" class="external-link">Bauer <em>et al.</em>, 2016</a>.
It is common consensus that such two-stage designs should still maintain
strict control of the maximal type one error rate despite the data
dependent decision at the interim analysis. Most authors use combination
function approaches to combine either the independent p values or test
statistics from the respective stages. Doing so with pre-specified
weights maintains the type one error rate control.</p>
<p>With <strong>adoptr</strong> we provide tools to explore optimal
two-stage designs for one or two-arm clinical trials with
(asymptotically) normally distributed and stage-wise independent test
statistics. In <a href="https://doi.org/10.1002/sim.8291" class="external-link">Pilz <em>et
al.</em>, 2019</a>, it was argued that such techniques are not
necessary, in fact, that they are counter-productive, since the
pre-specified weights might be sub-optimal. Instead, one may see the
problem of defining an optimal two-stage designs as a variational
problem to find the optimal configuration
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùíü</mi><mo>:=</mo><mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">(</mo><msub><mi>n</mi><mn>1</mn></msub><mo>,</mo><msubsup><mi>c</mi><mn>1</mn><mi>e</mi></msubsup><mo>,</mo><msubsup><mi>c</mi><mn>1</mn><mi>f</mi></msubsup><mo>,</mo><msub><mi>n</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>c</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow><mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
\mathcal{D}:=\big(n_1, c_1^e, c_1^f, n_2(\cdot), c_2(\cdot)\big)
</annotation></semantics></math> directly for a given objective function
and potentially a set of constraints. The relaxation of this
mixed-integer problem to the real numbers can then be solved with
standard methods from analysis. E.g., one could construct an implicit
solution by solving the corresponding Euler-Lagrange equation for given
first-stage and then find an optimal first-stage configuration, cf.¬†<a href="https://doi.org/10.1002/sim.8291" class="external-link">Pilz <em>et al.</em>, 2019</a>.
Instead, the <strong>adoptr</strong> package implements a direct
numerical solution algorithm by embedding the variation problem via a
set of pivot points in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>‚Ñù</mi><mi>k</mi></msup><annotation encoding="application/x-tex">\mathbb{R}^k</annotation></semantics></math>
and solving the corresponding finite-dimensional problem using
gradient-free numerical optimization procedures (COBYLA / nloptr).</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Consider the two-arm case comparing two group means mean. Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ¥</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>
be the difference in means and assume that the aim is to reject the null
hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>‚Ñã</mi><mn>0</mn></msub><mo>:</mo><mi>Œ¥</mi><mo>‚â§</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\mathcal{H}_0: \delta \leq 0</annotation></semantics></math>.
Further assume that a power of 80% at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ¥</mi><mo>=</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">\delta=0.4</annotation></semantics></math>
and a type-one-error rate of 2.5% on the boundary of the null hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ¥</mi><mo>‚â§</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">\delta\leq0.0</annotation></semantics></math>
is required.</p>
<p>In this situation, the one-sided t-test would require a sample size
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>51</mn><annotation encoding="application/x-tex">51</annotation></semantics></math>
individuals per-group. If we were willing to accept the fact that the
sample size of a two-stage design is inherently unknown at the planning
stage, we could reduce the <em>expected</em> sample size under the
alternative by optimizing a two-stage design with respect to this
quantity. Since the two-stage design, by definition, has more degrees of
freedom than the single-stage design, it must be at least as good in
terms of expected sample size as the single-stage design - for which the
expected sample size is always 51.</p>
<div class="section level3">
<h3 id="define-hypotheses-and-data-generating-mechanism">Define hypotheses and data-generating mechanism<a class="anchor" aria-label="anchor" href="#define-hypotheses-and-data-generating-mechanism"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/optad/adoptr" class="external-link">adoptr</a></span><span class="op">)</span></span></code></pre></div>
<p>First, we define the null and alternative hypotheses as prior
distributions over the unknown parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ¥</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">.0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">H_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Next, we define the data-generating mechanism (data distribution).
Currently, normally distributed test statistics with known variance, and
the normal approximation of binary endpoints are supported. In this
example, we choose a normal distribution, i.e., assume a continuous
outcome. For an example with binomial data distribution, cf.¬†the
vignette <a href="https://optad.github.io/adoptr/articles/composite-scores.html">composite
scores</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datadist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span>two_armed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specify-optimization-problem">Specify optimization problem<a class="anchor" aria-label="anchor" href="#specify-optimization-problem"></a>
</h3>
<p>We begin by defining the expected sample size under the alternative
hypothesis:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ess</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalSampleSize-class.html">ExpectedSampleSize</a></span><span class="op">(</span><span class="va">datadist</span>, <span class="va">H_1</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, we can define the power and the type-one-error rate by
integrating conditional power with respect to the alternative or null
hypothesis respectively:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">Power</a></span><span class="op">(</span><span class="va">datadist</span>, <span class="va">H_1</span><span class="op">)</span></span>
<span><span class="va">toer</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">Power</a></span><span class="op">(</span><span class="va">datadist</span>, <span class="va">H_0</span><span class="op">)</span></span></code></pre></div>
<p>To complete the problem specification, we only need to provide an
initial design and an integration order for the Gaussian quadrature rule
to be used for the numerical integration of the variational objective
between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>c</mi><mn>1</mn><mi>f</mi></msubsup><annotation encoding="application/x-tex">c_1^f</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>c</mi><mn>1</mn><mi>e</mi></msubsup><annotation encoding="application/x-tex">c_1^e</annotation></semantics></math>.
<strong>adoptr</strong> provides a heuristic method to obtain an initial
design. It is based on a one-stage design under specific constraints on
type one error rate and power. However, it may be more efficient to use
a situation-specific initial design.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_initial_design.html">get_initial_design</a></span><span class="op">(</span></span>
<span>  theta <span class="op">=</span> <span class="fl">.4</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">.025</span>,</span>
<span>  beta  <span class="op">=</span> <span class="fl">.2</span>,</span>
<span>  type_design  <span class="op">=</span> <span class="st">"two-stage"</span>,</span>
<span>  dist  <span class="op">=</span> <span class="va">datadist</span>,</span>
<span>  order <span class="op">=</span> <span class="fl">7L</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The decision boundaries are heuristically picked in concordance with
those of the single-stage design. We can then check whether the initial
design fulfills the constraints on the operating characteristics:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">power</span>, <span class="va">initial_design</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.797953</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">toer</span>, <span class="va">initial_design</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.02499995</span></span></code></pre></div>
<p>We can now proceed with defining and solving the optimization
problem:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opt_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/minimize.html">minimize</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="va">ess</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/subject_to.html">subject_to</a></span><span class="op">(</span></span>
<span>    <span class="va">power</span> <span class="op">&gt;=</span> <span class="fl">0.8</span>,</span>
<span>    <span class="va">toer</span>  <span class="op">&lt;=</span> <span class="fl">.025</span></span>
<span>  <span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="va">initial_design</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here, the default setting for the optimizer and box constraints seem
to have worked out. The numerical procedure converged after</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opt_res</span><span class="op">$</span><span class="va">nloptr_return</span><span class="op">$</span><span class="va">iterations</span></span></code></pre></div>
<p>iterations.</p>
<p>We can plot the resulting optimized design may again be plotted
together with its conditional power.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">opt_res</span><span class="op">$</span><span class="va">design</span>, </span>
<span>  <span class="st">"Conditional power"</span> <span class="op">=</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">ConditionalPower</a></span><span class="op">(</span><span class="va">datadist</span>, <span class="va">H_1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="adoptr_files/figure-html/plot-optimal-design-1.png" width="672"></p>
<p>Numerical integration yields an expected sample size of</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">ess</span>, <span class="va">opt_res</span><span class="op">$</span><span class="va">design</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 39.85593</span></span></code></pre></div>
<p>which is way below the single-stage 51. We can check this results
against simulated values</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span></span>
<span>  <span class="va">opt_res</span><span class="op">$</span><span class="va">design</span>, </span>
<span>  nsim <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fl">6</span>, </span>
<span>  dist <span class="op">=</span> <span class="va">datadist</span>, </span>
<span>  theta <span class="op">=</span> <span class="fl">.4</span>, </span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">df_sim</span><span class="op">$</span><span class="va">n1</span> <span class="op">+</span> <span class="va">df_sim</span><span class="op">$</span><span class="va">n2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 39.84</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.01372648</span></span></code></pre></div>
<p>The values from simulation and numerical integration are almost
identical and the constraints are also met almost perfectly:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">toer</span>, <span class="va">opt_res</span><span class="op">$</span><span class="va">design</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.02500571</span></span>
<span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">power</span>, <span class="va">opt_res</span><span class="op">$</span><span class="va">design</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7985303</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="variations">Variations<a class="anchor" aria-label="anchor" href="#variations"></a>
</h3>
<p>The purpose of <strong>adoptr</strong> is to provide a high-level
interface for exploring and comparing different designs and to
experiment with different combinations of objective functions and
constraints. In particular, <strong>adoptr</strong> supports:</p>
<ul>
<li><p>Important predefined scores as (conditional) power or sample size
functions as well as a framework for constraints on scores (cf.¬†<a href="https://optad.github.io/adoptr/articles/conditional-scores.html">conditional
scores</a>).</p></li>
<li><p>Arbitrary continuous or discrete <a href="https://optad.github.io/adoptr/articles/working-with-priors.html">prior
distributions</a> for the single location parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ∏</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
of the test statistic.</p></li>
<li><p>Support for simple arithmetic operations on scores to quickly
define weighted sums etc. (cf.¬†<a href="https://optad.github.io/adoptr/articles/composite-scores.html">composite
scores</a>).</p></li>
<li><p>Relatively flexible framework for <a href="https://optad.github.io/adoptr/articles/defining-new-scores.html">defining
new scores</a>.</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kevin Kunzmann, Maximilian Pilz, Jan Meis, Nico Bruder.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
