<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Find optimal two-stage design by constraint minimization — minimize • adoptr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Find optimal two-stage design by constraint minimization — minimize"><meta name="description" content="minimize takes an unconditional score and
a constraint set (or no constraint) and solves the corresponding
minimization problem using
nloptr
(using COBYLA by default).
An initial design has to be defined. It is also possible to define
lower- and upper-boundary designs. If this is not done, the boundaries are
determined automatically heuristically."><meta property="og:description" content="minimize takes an unconditional score and
a constraint set (or no constraint) and solves the corresponding
minimization problem using
nloptr
(using COBYLA by default).
An initial design has to be defined. It is also possible to define
lower- and upper-boundary designs. If this is not done, the boundaries are
determined automatically heuristically."><meta property="og:image" content="https://optad.github.io/adoptr/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">adoptr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/adoptr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/adoptr_jss.html">Overview Paper</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/working-with-priors.html">Working with Priors</a></li>
    <li><a class="dropdown-item" href="../articles/conditional-scores.html">Conditional Scores</a></li>
    <li><a class="dropdown-item" href="../articles/composite-scores.html">Composite Scores</a></li>
    <li><a class="dropdown-item" href="../articles/defining-new-scores.html">Definining New Scores</a></li>
    <li><a class="dropdown-item" href="../articles/other-endpoints.html">Non-normal Endpoints</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/optad/adoptr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Find optimal two-stage design by constraint minimization</h1>
      <small class="dont-index">Source: <a href="https://github.com/optad/adoptr/blob/main/R/minimize.R" class="external-link"><code>R/minimize.R</code></a></small>
      <div class="d-none name"><code>minimize.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>minimize</code> takes an unconditional score and
a constraint set (or no constraint) and solves the corresponding
minimization problem using
<a href="https://cran.r-project.org/package=nloptr" class="external-link"><code>nloptr</code></a>
(using COBYLA by default).
An initial design has to be defined. It is also possible to define
lower- and upper-boundary designs. If this is not done, the boundaries are
determined automatically heuristically.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">minimize</span><span class="op">(</span></span>
<span>  <span class="va">objective</span>,</span>
<span>  <span class="va">subject_to</span>,</span>
<span>  <span class="va">initial_design</span>,</span>
<span>  lower_boundary_design <span class="op">=</span> <span class="fu"><a href="boundary-designs.html">get_lower_boundary_design</a></span><span class="op">(</span><span class="va">initial_design</span><span class="op">)</span>,</span>
<span>  upper_boundary_design <span class="op">=</span> <span class="fu"><a href="boundary-designs.html">get_upper_boundary_design</a></span><span class="op">(</span><span class="va">initial_design</span><span class="op">)</span>,</span>
<span>  c2_decreasing <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  check_constraints <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>algorithm <span class="op">=</span> <span class="st">"NLOPT_LN_COBYLA"</span>, xtol_rel <span class="op">=</span> <span class="fl">1e-05</span>, maxeval <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-objective">objective<a class="anchor" aria-label="anchor" href="#arg-objective"></a></dt>
<dd><p>objective function</p></dd>


<dt id="arg-subject-to">subject_to<a class="anchor" aria-label="anchor" href="#arg-subject-to"></a></dt>
<dd><p>constraint collection</p></dd>


<dt id="arg-initial-design">initial_design<a class="anchor" aria-label="anchor" href="#arg-initial-design"></a></dt>
<dd><p>initial guess (x0 for nloptr)</p></dd>


<dt id="arg-lower-boundary-design">lower_boundary_design<a class="anchor" aria-label="anchor" href="#arg-lower-boundary-design"></a></dt>
<dd><p>design specifying the lower boundary.</p></dd>


<dt id="arg-upper-boundary-design">upper_boundary_design<a class="anchor" aria-label="anchor" href="#arg-upper-boundary-design"></a></dt>
<dd><p>design specifying the upper boundary</p></dd>


<dt id="arg-c-decreasing">c2_decreasing<a class="anchor" aria-label="anchor" href="#arg-c-decreasing"></a></dt>
<dd><p>if TRUE, the c2_pivots are forced to be monotonically decreasing</p></dd>


<dt id="arg-check-constraints">check_constraints<a class="anchor" aria-label="anchor" href="#arg-check-constraints"></a></dt>
<dd><p>if TRUE, it is checked if constrains are fulfilled</p></dd>


<dt id="arg-opts">opts<a class="anchor" aria-label="anchor" href="#arg-opts"></a></dt>
<dd><p>options list passed to nloptr</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>further optional arguments passed to <code><a href="https://astamm.github.io/nloptr/reference/nloptr.html" class="external-link">nloptr</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a list with elements:</p>
<dl><dt>design</dt>
<dd><p>The resulting optimal design</p></dd>

<dt>nloptr_return</dt>
<dd><p>Output of the corresponding nloptr call</p></dd>

<dt>call_args</dt>
<dd><p>The arguments given to the optimization call</p></dd>

</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Define Type one error rate</span></span></span>
<span class="r-in"><span><span class="va">toer</span> <span class="op">&lt;-</span> <span class="fu"><a href="ConditionalPower-class.html">Power</a></span><span class="op">(</span><span class="fu"><a href="NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define Power at delta = 0.4</span></span></span>
<span class="r-in"><span><span class="va">pow</span> <span class="op">&lt;-</span> <span class="fu"><a href="ConditionalPower-class.html">Power</a></span><span class="op">(</span><span class="fu"><a href="NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define expected sample size at delta = 0.4</span></span></span>
<span class="r-in"><span><span class="va">ess</span> <span class="op">&lt;-</span> <span class="fu"><a href="ConditionalSampleSize-class.html">ExpectedSampleSize</a></span><span class="op">(</span><span class="fu"><a href="NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute design minimizing ess subject to power and toer constraints</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu">minimize</span><span class="op">(</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="va">ess</span>,</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="subject_to.html">subject_to</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="va">toer</span> <span class="op">&lt;=</span> <span class="fl">0.025</span>,</span></span>
<span class="r-in"><span>      <span class="va">pow</span>  <span class="op">&gt;=</span> <span class="fl">0.9</span></span></span>
<span class="r-in"><span>   <span class="op">)</span>,</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   initial_design <span class="op">=</span> <span class="fu"><a href="TwoStageDesign-class.html">TwoStageDesign</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">.0</span>, <span class="fl">2.0</span>, <span class="fl">60.0</span>, <span class="fl">2.0</span>, <span class="fl">5L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $design</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> TwoStageDesign&lt;n1=68;0.3&lt;=x1&lt;=2.3:n2=26-131&gt; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $nloptr_return</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nloptr::nloptr(x0 = tunable_parameters(initial_design), eval_f = f_obj, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lb = tunable_parameters(lower_boundary_design), ub = tunable_parameters(upper_boundary_design), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     eval_g_ineq = g_cnstr, opts = opts)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minimization using NLopt version 2.7.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NLopt solver status: 4 ( NLOPT_XTOL_REACHED: Optimization stopped because </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> xtol_rel or xtol_abs (above) was reached. )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Iterations....: 3990 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Termination conditions:  xtol_rel: 1e-05	maxeval: 10000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of inequality constraints:  3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of equality constraints:    0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal value of objective function:  99.2099508305843 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal value of controls: 67.77852 0.2812201 2.26569 126.9927 111.6292 86.5138 57.48934 32.48944 2.668702 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.35649 1.822003 1.113608 0.3340881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args$objective</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[n(x1)] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args$subject_to</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An object of class "ConstraintsCollection"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Slot "unconditional_constraints":</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pr[x2&gt;=c2(x1)] &lt;= 0.025 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -Pr[x2&gt;=c2(x1)]  &lt;= -0.9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Slot "conditional_constraints":</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> list()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args$initial_design</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> TwoStageDesign&lt;n1=50;0.0&lt;=x1&lt;=2.0:n2=60&gt; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args$lower_boundary_design</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> TwoStageDesign&lt;n1=1;-2.0&lt;=x1&lt;=0.0:n2=1&gt; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args$upper_boundary_design</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> TwoStageDesign&lt;n1=250;2.0&lt;=x1&lt;=4.0:n2=300&gt; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args$c2_decreasing</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args$check_constraints</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args$opts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args$opts$algorithm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "NLOPT_LN_COBYLA"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args$opts$xtol_rel</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call_args$opts$maxeval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 10000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "adoptrOptimizationResult" "list"                    </span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kevin Kunzmann, Maximilian Pilz, Jan Meis, Nico Bruder.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

